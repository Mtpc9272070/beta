<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ADUCHAT - Juego Incoterms</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Animaciones */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(18px);} to { opacity: 1; transform: translateY(0);} }\
    .animate-fade-in { animation: fadeIn .45s ease-out; }\

    @keyframes bounceY { 0%,100% { transform: translateY(0);} 50% { transform: translateY(-6px);} }\
    .animate-bounce-y { animation: bounceY 1s infinite alternate; }\

    /* Logo circle */
    .logo-circle { width:48px; height:48px; border-radius:12px; display:inline-flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#10b981,#047857); box-shadow:0 8px 20px rgba(4, 120, 87, .12); }\
  </style>
</head>
<body class="bg-green-50 min-h-screen flex items-center justify-center p-4 font-sans">\

  <div class="w-full max-w-3xl">\

    <header class="flex items-center justify-between bg-white rounded-2xl shadow-xl p-4 mb-4">\
      <div class="flex items-center space-x-3">\
        <div class="logo-circle">\
          <span class="text-2xl" role="img" aria-label="ship">🚢</span>\
        </div>\
        <h1 class="text-xl font-bold text-gray-800">Prueba de Incoterms 2020</h1>\
      </div>\
      <button onclick="backToMainFromIcoterms()" class="bg-red-500 text-white font-semibold px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">\
        Volver al Dashboard\
      </button>\
    </header>\

    <main class="bg-white rounded-2xl shadow-xl p-6 md:p-8 animate-fade-in">\
\
      <div id="nameDisplay" class="p-3 mb-4 rounded-xl border-2 text-center text-sm font-semibold bg-red-100 border-red-400 text-red-700">\
        Cargando nombre del jugador...\
      </div>\

      <div id="gameContent" class="hidden">\
        \
        <div id="modeSelection">\
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Selección de Modo</h2>\
          <p class="text-gray-600 mb-6">Elige cómo quieres practicar los Incoterms:</p>\
          <div class="space-y-4">\
            <button onclick="openRandom()" class="w-full bg-green-500 text-white font-semibold py-4 rounded-xl shadow-md hover:bg-green-600 transition transform hover:scale-[1.01]">\
              🎲 Incoterms Aleatorios (Recomendado)\
            </button>\
            <button onclick="openFull()" class="w-full bg-blue-500 text-white font-semibold py-4 rounded-xl shadow-md hover:bg-blue-600 transition transform hover:scale-[1.01]">\
              📚 Modo Estudio (Ver todos)\
            </button>\
            <button onclick="openCustom()" class="w-full bg-yellow-500 text-gray-800 font-semibold py-4 rounded-xl shadow-md hover:bg-yellow-600 transition transform hover:scale-[1.01]">\
              🛠️ Personalizado (Elegir grupo)\
            </button>\
          </div>\
        </div>\

        \
        <div id="quizScreen" class="hidden">\
          <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-200">\
            <p id="incotermName" class="text-3xl font-extrabold text-green-700">INCOTERM</p>\
            <p id="scoreDisplay" class="text-2xl font-bold text-blue-600">Puntaje: 0</p>\
          </div>\

          <div id="questionText" class="text-xl text-gray-700 mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">\
            Pregunta\
          </div>\

          <div id="optionsContainer" class="space-y-3">\
            \
          </div>\

          <div id="feedbackContainer" class="mt-6 p-4 rounded-lg text-white font-bold hidden">\
            \
          </div>\

          <div class="flex justify-between mt-6 pt-4 border-t border-gray-100">\
            <button onclick="nextQuestion()" id="nextBtn" class="bg-gray-300 text-gray-800 font-semibold px-6 py-3 rounded-xl hover:bg-gray-400 transition-colors" disabled>\
              Siguiente →\
            </button>\
            <button onclick="quitGame()" class="bg-red-500 text-white font-semibold px-6 py-3 rounded-xl hover:bg-red-600 transition-colors">\
              Salir\
            </button>\
          </div>\
        </div>\

        \
        <div id="resultScreen" class="hidden text-center">\
          <h2 class="text-3xl font-extrabold text-green-600 mb-4">🎉 ¡Prueba Finalizada!</h2>\
          <p class="text-gray-700 text-xl mb-6">Tu puntuación promedio por Incoterm es:</p>\
          <p id="finalAverageScore" class="text-6xl font-black text-blue-700 mb-8">0.0</p>\

          <button onclick="saveFinalResult()" class="bg-green-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:bg-green-700 transition transform hover:scale-105 mb-4">\
            Guardar y ver Ranking\
          </button>\
\
          <div class="mt-8">\
              <h3 class="text-xl font-bold mb-3 text-gray-700">Mejores Puntajes (Top 5)</h3>\
              <div id="rankingList" class="space-y-2 bg-gray-50 p-4 rounded-xl border border-gray-200">\
                \
              </div>\
          </div>\
\
          <button onclick="restart()" class="bg-gray-300 text-gray-800 font-semibold py-2 px-6 rounded-xl hover:bg-gray-400 mt-6">\
            Volver a Jugar\
          </button>\
        </div>\
      </div>\
    </main>\
  </div>\

  \
  <script type="module">\
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";\
    import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js";\

    // ⚙️ Configuración Firebase\
    const firebaseConfig = { /* ... (tus datos de config) ... */ };\
    // Omitiendo datos reales por seguridad, reemplaza con tu configuración:\
    const app = initializeApp({}); // Asume inicialización correcta\
    const db = getFirestore(app);\

    // -------------------------------------------\
    // 🆕 FUNCIÓN CLAVE: Leer el nombre de la URL\
    // -------------------------------------------\
    function getPlayerNameFromUrl() {\
        const params = new URLSearchParams(window.location.search);\
        return params.get('name');\
    }\
    \
    // 🔙 Función para volver al Dashboard\
    function backToMainFromIcoterms() {\
        window.location.href = "index.html";\
    }\
    window.backToMainFromIcoterms = backToMainFromIcoterms; \
    // -------------------------------------------\

    // ... (El resto de tus definiciones de Incoterms y preguntas)\
    const incotermsQuestions = { /* ... */ };\
    // ... (Tus preguntas de Incoterms aquí)\

    // Estado del juego\
    let incotermsToPlay = [];\
    let currentIncotermIndex = 0;\
    let currentQuestionIndex = 0;\
    let perLevelScores = {}; // Puntaje por cada Incoterm\
\
    // 🆕 Inicialización del objeto jugador con nombre vacío\
    let player = { name: "" };\
    window.player = player;\
\
    // Elementos de la UI\
    const gameContent = document.getElementById('gameContent');\
    const nameDisplay = document.getElementById('nameDisplay');\
    const scoreDisplay = document.getElementById('scoreDisplay');\
    const incotermNameEl = document.getElementById('incotermName');\
    const questionTextEl = document.getElementById('questionText');\
    const optionsContainer = document.getElementById('optionsContainer');\
    const feedbackContainer = document.getElementById('feedbackContainer');\
    const nextBtn = document.getElementById('nextBtn');\
    const quizScreen = document.getElementById('quizScreen');\
    const resultScreen = document.getElementById('resultScreen');\
    const modeSelection = document.getElementById('modeSelection');\
\
    // -------------------------------------------\
    // 🚨 ELIMINADA LA LÓGICA DE FIREBASE AUTH\
    // -------------------------------------------\
    // Se elimina: onAuthStateChanged(auth, (user) => { ... })\
    // y se reemplaza por la carga desde la URL en DOMContentLoaded\
\
    // ... (El resto de tus funciones: checkPlayerName, saveScoreToFirestore, loadTopRanking, etc)\
\
    // Funciones principales del juego\
    function openRandom() { /* ... */ }\
    function openFull() { /* ... */ }\
    function openCustom() { /* ... */ }\
    function startRandomMode() { /* ... */ }\
    function loadQuestion() { /* ... */ }\
    function checkAnswer(answerIndex) { /* ... */ }\
    function nextQuestion() { /* ... */ }\
    function showResults() { /* ... */ }\
    function restart() { /* ... */ }\
    function quitGame() { /* ... */ }\
    function saveFinalResult() { /* ... */ }\
    // ... (Funciones utilitarias)\
\
    // Export globals\
    window.openFull = openFull;\
    window.openRandom = openRandom;\
    window.openCustom = openCustom;\
    window.startRandomMode = startRandomMode;\
    window.saveFinalResult = saveFinalResult;\
    window.restart = restart;\
    window.quitGame = quitGame;\
\
    // -------------------------------------------\
    // 🔑 INICIALIZACIÓN DE LA APLICACIÓN\
    // -------------------------------------------\
    document.addEventListener('DOMContentLoaded', () => {\
      const urlPlayerName = getPlayerNameFromUrl();\
\
      if (urlPlayerName) {\
        // Caso de ÉXITO: Nombre encontrado en la URL\
        player.name = decodeURIComponent(urlPlayerName);\
        \
        nameDisplay.textContent = `Nombre de jugador activo: ${player.name}`;\
        nameDisplay.classList.remove('bg-red-100', 'border-red-400', 'text-red-700');\
        nameDisplay.classList.add('bg-green-50', 'border-green-200', 'text-green-700');\
        gameContent.classList.remove('hidden');\
        \
        loadTopRanking().catch(err => console.warn("Ranking no cargado:", err));\
      } else {\
        // Caso de ERROR: Nombre NO encontrado en la URL\
        nameDisplay.textContent = `🚨 Error: No se encontró un nombre de jugador. Por favor, regresa al dashboard y entra primero.`;\
        nameDisplay.classList.add('bg-red-100', 'border-red-400', 'text-red-700');\
        gameContent.classList.add('hidden'); // Ocultar el contenido del juego si no hay nombre\
      }\
\
    });\
  </script>\
</body>\
</html>\
